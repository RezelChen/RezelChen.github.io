<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/blog/lib/animate-css/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rezelchen.github.io","root":"/blog/","scheme":"Muse","version":"8.0.0-rc.4","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}}};
  </script>

  <meta name="description" content="Encoding and EvolutionFormats for Encoding DataLanguage-Specific FormatsIt’s generally a bad idea to use your language’s built-in encoding for anything other than very transient purposes. JSON, XML, a">
<meta property="og:type" content="article">
<meta property="og:title" content="Note for DDIA in Chapter 4">
<meta property="og:url" content="https://rezelchen.github.io/2020/07/28/DDIA4/index.html">
<meta property="og:site_name" content="Ray Chen&#39;s Blog">
<meta property="og:description" content="Encoding and EvolutionFormats for Encoding DataLanguage-Specific FormatsIt’s generally a bad idea to use your language’s built-in encoding for anything other than very transient purposes. JSON, XML, a">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-07-28T17:38:00.000Z">
<meta property="article:modified_time" content="2020-08-08T12:23:42.760Z">
<meta property="article:author" content="Ray Chen">
<meta property="article:tag" content="note">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://rezelchen.github.io/2020/07/28/DDIA4/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Note for DDIA in Chapter 4 | Ray Chen's Blog</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Ray Chen's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Encoding-and-Evolution"><span class="nav-number">1.</span> <span class="nav-text">Encoding and Evolution</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Formats-for-Encoding-Data"><span class="nav-number">1.1.</span> <span class="nav-text">Formats for Encoding Data</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Language-Specific-Formats"><span class="nav-number">1.1.1.</span> <span class="nav-text">Language-Specific Formats</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JSON-XML-and-Binary-Variants"><span class="nav-number">1.1.2.</span> <span class="nav-text">JSON, XML, and Binary Variants</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Binary-encoding"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">Binary encoding</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Thrift-and-Protocol-Buffers"><span class="nav-number">1.1.3.</span> <span class="nav-text">Thrift and Protocol Buffers</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Avro"><span class="nav-number">1.1.4.</span> <span class="nav-text">Avro</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#The-Merits-of-Schemas"><span class="nav-number">1.1.5.</span> <span class="nav-text">The Merits of Schemas</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Modes-of-Dataflow"><span class="nav-number">1.2.</span> <span class="nav-text">Modes of Dataflow</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Dataflow-Through-Databases"><span class="nav-number">1.2.1.</span> <span class="nav-text">Dataflow Through Databases</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Different-values-written-at-different-times"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">Different values written at different times</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Archival-storage"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">Archival storage</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dataflow-Through-Services-REST-and-RPC"><span class="nav-number">1.2.2.</span> <span class="nav-text">Dataflow Through Services: REST and RPC</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Web-services"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">Web services</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#The-problems-with-remote-procedure-calls-RPCs"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">The problems with remote procedure calls (RPCs)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Current-directions-for-RPC"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">Current directions for RPC</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Data-encoding-and-evolution-for-RPC"><span class="nav-number">1.2.2.4.</span> <span class="nav-text">Data encoding and evolution for RPC</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Message-Passing-Dataflow"><span class="nav-number">1.2.3.</span> <span class="nav-text">Message-Passing Dataflow</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Message-brokers"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">Message brokers</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Distributed-actor-frameworks"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">Distributed actor frameworks</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Ray Chen</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives">
          <span class="site-state-item-count">4</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content post posts-expand">
          

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://rezelchen.github.io/2020/07/28/DDIA4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Ray Chen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ray Chen's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Note for DDIA in Chapter 4
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-07-28 17:38:00" itemprop="dateCreated datePublished" datetime="2020-07-28T17:38:00+00:00">2020-07-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-08 12:23:42" itemprop="dateModified" datetime="2020-08-08T12:23:42+00:00">2020-08-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Encoding-and-Evolution"><a href="#Encoding-and-Evolution" class="headerlink" title="Encoding and Evolution"></a>Encoding and Evolution</h2><h3 id="Formats-for-Encoding-Data"><a href="#Formats-for-Encoding-Data" class="headerlink" title="Formats for Encoding Data"></a>Formats for Encoding Data</h3><h4 id="Language-Specific-Formats"><a href="#Language-Specific-Formats" class="headerlink" title="Language-Specific Formats"></a>Language-Specific Formats</h4><p>It’s generally a bad idea to use your language’s built-in encoding for anything other than very transient purposes.</p>
<h4 id="JSON-XML-and-Binary-Variants"><a href="#JSON-XML-and-Binary-Variants" class="headerlink" title="JSON, XML, and Binary Variants"></a>JSON, XML, and Binary Variants</h4><h5 id="Binary-encoding"><a href="#Binary-encoding" class="headerlink" title="Binary encoding"></a>Binary encoding</h5><h4 id="Thrift-and-Protocol-Buffers"><a href="#Thrift-and-Protocol-Buffers" class="headerlink" title="Thrift and Protocol Buffers"></a>Thrift and Protocol Buffers</h4><p>…</p>
<h4 id="Avro"><a href="#Avro" class="headerlink" title="Avro"></a>Avro</h4><p>…</p>
<h4 id="The-Merits-of-Schemas"><a href="#The-Merits-of-Schemas" class="headerlink" title="The Merits of Schemas"></a>The Merits of Schemas</h4><ul>
<li><p>They can be much more compact than the various “binary JSON” variants, since they can omit field names from the encoded data.</p>
</li>
<li><p>The schema is a valuable form of documentation, and because the schema is required for decoding, you can be sure that it is up to date (whereas manually maintained documentation may easily diverge from reality).</p>
</li>
<li><p>Keeping a database of schemas allows you to check forward and backward com‐ patibility of schema changes, before anything is deployed.</p>
</li>
<li><p>For users of statically typed programming languages, the ability to generate code from the schema is useful, since it enables type checking at compile time.</p>
</li>
</ul>
<p>In summary, schema evolution allows the same kind of flexibility as schemaless/schema-on-read JSON databases provide, while also providing better guarantees about your data and better tooling.</p>
<h3 id="Modes-of-Dataflow"><a href="#Modes-of-Dataflow" class="headerlink" title="Modes of Dataflow"></a>Modes of Dataflow</h3><h4 id="Dataflow-Through-Databases"><a href="#Dataflow-Through-Databases" class="headerlink" title="Dataflow Through Databases"></a>Dataflow Through Databases</h4><h5 id="Different-values-written-at-different-times"><a href="#Different-values-written-at-different-times" class="headerlink" title="Different values written at different times"></a>Different values written at different times</h5><p>Schema evolution thus allows the entire database to appear as if it was encoded with a single schema, even though the underlying storage may contain records encoded with various historical versions of the schema.</p>
<h5 id="Archival-storage"><a href="#Archival-storage" class="headerlink" title="Archival storage"></a>Archival storage</h5><h4 id="Dataflow-Through-Services-REST-and-RPC"><a href="#Dataflow-Through-Services-REST-and-RPC" class="headerlink" title="Dataflow Through Services: REST and RPC"></a>Dataflow Through Services: REST and RPC</h4><h5 id="Web-services"><a href="#Web-services" class="headerlink" title="Web services"></a>Web services</h5><h5 id="The-problems-with-remote-procedure-calls-RPCs"><a href="#The-problems-with-remote-procedure-calls-RPCs" class="headerlink" title="The problems with remote procedure calls (RPCs)"></a>The problems with remote procedure calls (RPCs)</h5><p>Although RPC seems convenient at first, the approach is fundamentally flawed. A network request is very different from a local function call:</p>
<ul>
<li><p>A local function call is predictable and either succeeds or fails, depending only on parameters that are under your control. A network request is unpredictable: the request or response may be lost due to a network problem, or the remote machine may be slow or unavailable, and such problems are entirely outside of your control. </p>
</li>
<li><p>A network request has another possible outcome: it may return without a result, due to a timeout. </p>
</li>
<li><p>If you retry a failed network request, it could happen that the requests are actually getting through, and only the responses are getting lost. In that case, retrying will cause the action to be performed multiple times, unless you build a mechanism for deduplication (idempotence) into the protocol.</p>
</li>
<li><p>A network request is much slower than a function call, and its latency is also wildly variable.</p>
</li>
<li><p>When you call a local function, you can efficiently pass it references (pointers) to objects in local memory. When you make a network request, all those parameters need to be encoded into a sequence of bytes that can be sent over the network.</p>
</li>
<li><p>The client and the service may be implemented in different programming lan‐ guages, so the RPC framework must translate datatypes from one language into another.</p>
</li>
</ul>
<h5 id="Current-directions-for-RPC"><a href="#Current-directions-for-RPC" class="headerlink" title="Current directions for RPC"></a>Current directions for RPC</h5><p>The main focus of RPC frameworks is on requests between services owned by the same organization, typically within the same datacenter.</p>
<h5 id="Data-encoding-and-evolution-for-RPC"><a href="#Data-encoding-and-evolution-for-RPC" class="headerlink" title="Data encoding and evolution for RPC"></a>Data encoding and evolution for RPC</h5><p>We can make a simplifying assumption in the case of dataflow through services: it is reasonable to assume that all the servers will be updated first, and all the clients second. Thus, you only need backward compatibility on requests, and forward compatibility on responses.</p>
<p>If a compatibility-breaking change is required, the service provider often ends up maintaining multiple versions of the service API side by side.</p>
<h4 id="Message-Passing-Dataflow"><a href="#Message-Passing-Dataflow" class="headerlink" title="Message-Passing Dataflow"></a>Message-Passing Dataflow</h4><p>Using a message broker has several advantages compared to direct RPC:</p>
<ul>
<li><p>It can act as a buffer if the recipient is unavailable or overloaded, and thus improve system reliability.</p>
</li>
<li><p>It can automatically redeliver messages to a process that has crashed, and thus prevent messages from being lost.</p>
</li>
<li><p>It avoids the sender needing to know the IP address and port number of the recipient.</p>
</li>
<li><p>It allows one message to be sent to several recipients.</p>
</li>
<li><p>It logically decouples the sender from the recipient.</p>
</li>
</ul>
<p>However, a difference compared to RPC is that message-passing communication is usually one-way: a sender normally doesn’t expect to receive a reply to its messages. </p>
<h5 id="Message-brokers"><a href="#Message-brokers" class="headerlink" title="Message brokers"></a>Message brokers</h5><h5 id="Distributed-actor-frameworks"><a href="#Distributed-actor-frameworks" class="headerlink" title="Distributed actor frameworks"></a>Distributed actor frameworks</h5><p>The <em>actor model</em> is a programming model for concurrency in a single process. Each actor typically represents one client or entity, it may have some local state, and it communicates with other actors by sending and receiving asynchronous messages. Message delivery is not guaranteed: in certain error scenarios, mes‐ sages will be lost. Since each actor processes only one message at a time, it doesn’t need to worry about threads, and each actor can be scheduled independently by the framework.</p>
<p>In <em>distributed actor frameworks</em>, this programming model is used to scale an applica‐ tion across multiple nodes. The same message-passing mechanism is used, no matter whether the sender and recipient are on the same node or different nodes. </p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/note/" rel="tag"># note</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/blog/2020/07/24/DDIA3/" rel="prev" title="Note for DDIA in Chapter 3">
      <i class="fa fa-chevron-left"></i> Note for DDIA in Chapter 3
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



        </div>
        

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ray Chen</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/muse.js"></script>


<script src="/blog/js/next-boot.js"></script>


  















  

  

</body>
</html>
